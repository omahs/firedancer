# Generate temporary directory for clone
- name: Create temporary directory
  ansible.builtin.tempfile:
    state: directory
    prefix: labs_repo_
  register: labs_repo_dir

# Clone git repo at desired tag/branch
- name: Clone repository
  git:
    repo: "{{ labs_repo }}"
    dest: "{{ labs_repo_dir.path }}"
    version: "{{ labs_repo_version }}"
    force: true
    depth: 1

# TODO: Install solana dependencies

- name: Build Solana Labs
  script:
    cmd: "files/labs_build.sh --{{ labs_build_profile }} {{ labs_build_targets }}"
    chdir: "{{ labs_repo_dir.path }}"

- name: Set solana labs binaries directory
  set_fact:
    labs_bin: "{{ labs_repo_dir.path }}/target/{{ labs_build_profile }}"
